# План Разработки Сборки CORE

## 1. Видение и Концепция (GDD)

**Название:** CORE (Вдохновлено RotN)
**Версия:** 1.20.1 (Forge)
**Жанр:** Roguelite Survival с Мета-Прогрессией.
**Ключевые Столпы:**

- **Архитектура Выживания:** Строительство базы функционально необходимо. "Герметичные" базы работают эффективнее.
- **Тиры Прогрессии:** Технологии и Магия открываются через "кормление" Ядра (The Core).
- **Мета-Цикл:** Смерть -> Лимбо (Магазин за Черные Дублоны) -> Перерождение.
- **Атмосфера:** Глубокое погружение, единый стиль UI, хардкор.

## 2. Процесс и Правила

### А) Правила Агента (Мои инструкции)

1. **Сначала Git:** Все изменения (конфиги, скрипты) через Git.
2. **Понятность:** Писать по-русски. Объяснять *что* и *зачем* делаю перед выполнением.
3. **Один мод за раз:** Полный цикл (Установка -> Конфиг -> Скрипт -> Тест) перед переходом к следующему.
4. **Чистота:** Использовать папку `_dev` для временных скриптов.
5. **Без галлюцинаций:** Использовать только те файлы, которые реально существуют.

### Б) Действия Игрока (Твои инструкции)

1. **Выбор модов:** Одобрять или отклонять предложения.
2. **Геймдизайн:** Принимать решения по балансу (например, "ломают ли криперы блоки?").
3. **Тесты:** Запускать игру для проверки, когда я попрошу.
4. **GitHub:** Управлять доступом к репозиторию.

## 3. Технические Стандарты (Под капотом)

### 3.1 Структура и Приоритеты Загрузки

Minecraft на Forge 1.20.1 загружает контент в следующем (упрощенном) порядке:

1. **Libraries & CoreMods:** Базовые библиотеки (Mixin, Architectury). Конфликты здесь крашат игру до окна загрузки.
2. **Mods (Common/Jars):** Инициализация кода модов.
3. **Startup Scripts (KubeJS):** Регистрация *новых* предметов/блоков. Загружаются ДО мира.
4. **Common Configs (.toml):** Основные настройки модов.
5. **Datapacks (OpenLoader/KubeJS):**
    - Уровни приоритета: `Global Packs` > `KubeJS Generated` > `Mod Resources` > `Vanilla`.
    - Здесь мы меняем рецепты, теги и таблицы лута.
6. **Server Scripts (KubeJS):** Скрипты, работающие во время игры (события, динамические рецепты). Перезагружаются командой `/reload`.

### 3.2 Типы Конфигураций

- **Common (.toml):** Настройки генерации мира, механики модов. Лежат в `config/`.
- **Client (.toml):** Только визуал (шейдеры, меню, тултипы). Не влияют на сервер.
- **Server-Config (внутри save/serverconfig):** Настройки конкретного мира (шансы спавна, урон мобов). *Важно:* Чтобы применить их ко всем новым мирам, мы будем копировать их в `defaultconfigs/`.

### 3.3 Унификация (Tags)

Чтобы избежать дублей (5 видов медной руды), мы используем теги Forge:

- `#forge:ingots/copper` — единый тег для всех слитков меди.
- **Принцип CORE:** Мы форсируем использование предметов из `Minecraft` > `Create` > `Thermal`. Всё остальное скрываем из JEI и отключаем генерацию.

### 3.4 Локализация (Lang Files)

Строгое правило: **Никакого хардкода текста в скриптах!**

1. **Keys:** Весь текст выносим в языковые ключи. Пример: `Text.translate('core.stage.locked')`.
2. **Files:** Поддерживаем два файла локализации в `kubejs/assets/core/lang/`:
    - `en_us.json` (База)
    - `ru_ru.json` (Обязательный перевод)
3. **Process:** При создании любого скрипта с текстом сразу добавляем ключи в оба lang-файла.

### 3.5 Модульность и Безопасность

Сборка должна быть гибкой. Если мы отключим условный `Create`, игра должна запуститься (пусть и с кучей бесполезных скриптов, но без краша).

1. **Soft Dependencies:** В скриптах проверяем наличие мода перед выполнением кода:  
    `if (Platform.isLoaded('create')) { ... }`
2. **Tags over Items:** В рецептах используем теги (`#forge:ingots/copper`) вместо конкретных ID (`create:copper_ingot`). Это позволит менять моды-источники ресурсов без переписывания скриптов.
3. **Изоляция Скриптов:** Скрипты мода лежат в `server_scripts/mods/[ModName]/`. Не сваливаем всё в один файл.

### 3.6 Git Workflow (Ветки и Порядок работы)

Чтобы не ломать сборку ("стабильную базу"), мы работаем в ветках.

1. **Main Branch (`main`):** Только стабильный, проверенный код.
2. **Feature Branches (`feat/NAME`):** Вся разработка идет здесь (пример: `feat/tier0-restrictions`).
3. **Workflow:**
    - `git checkout -b feat/task-name`
    - Делаем скрипты, конфиги, тесты.
    - Презентуем Игроку.
    - После одобрения -> `git checkout main` -> `git merge feat/task-name`.

## 4. Пайплайн (Порядок работ)

### Фаза 1: Фундамент ("База")

*Цель: Стабильный, красивый и быстрый скелет.*

1. **Repo & Tools:** Git init, `.gitignore`. (Готово)
2. **Унификация:** Настройка `Almost Unified`.
3. **Скрипты:** Структура папок `KubeJS`.
4. **UI/UX:** Настройка `FancyMenu`, шрифтов.
5. **Генерация:** Проверка связки `Terralith` + `Distant Horizons`.

### Фаза 2: Геймплей

*Цель: Добавление контента мод-за-модом.*

1. **Создать ветку:** `git checkout -b feat/[feature-name]`
2. **Добавить мод:** Скачать/Установить.
3. **Конфиг:** Настроить баланс.
4. **Скрипт:** Добавить рецепты в KubeJS.
5. **Коммит:** `git commit -m "feat: Добавлен [ModName]"`
6. **Merge:** Слияние с main после теста.

### Фаза 3: Мета-Прогрессия

*Цель: Игровой цикл.*

1. **Game Stages:** Настройка уровней доступа.
2. **Квесты:** Структура FTB Quests.
3. **Лут:** Кастомные таблицы лута.
